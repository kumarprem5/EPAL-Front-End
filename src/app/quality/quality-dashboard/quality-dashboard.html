<div class="dashboard-container">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- HEADER -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo">
          <span class="logo-icon">âœ…</span>
          <span class="logo-text">Lab Quality Portal</span>
        </div>
      </div>
      <div class="header-right">
        <div class="user-info">
          <span class="user-icon">ğŸ‘¤</span>
          <span class="user-name">{{ currentUser?.qualityName || currentUser?.name || 'Quality Team' }}</span>
        </div>
        <button class="logout-btn" (click)="logout()">
          <span>ğŸšª</span> Logout
        </button>
      </div>
    </div>
  </header>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- GLOBAL LOADING OVERLAY -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="global-loading" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>Loading dashboard...</p>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- STATS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="stats-section">
    <div class="stats-grid">

      <div class="stat-card">
        <div class="stat-icon pending">â³</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.pendingQA }}</div>
          <div class="stat-label">Pending QA</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon approved-today">ğŸ“…</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.approvedToday }}</div>
          <div class="stat-label">Approved Today</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon total-approved">âœ…</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.totalApproved }}</div>
          <div class="stat-label">Total Approved</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon total">ğŸ“Š</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.totalProcessed }}</div>
          <div class="stat-label">Total Processed</div>
        </div>
      </div>

    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SEARCH -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="search-section">
    <div class="section-header">
      <h2 class="section-title">Search Samples</h2>
      <p class="section-subtitle">Find quality-ready samples by report number, company name, or sample ID</p>
    </div>

    <div class="search-tabs">
      <button class="search-tab" [class.active]="searchType === 'reportNumber'" (click)="onSearchTypeChange('reportNumber')">
        ğŸ“„ Report Number
      </button>
      <button class="search-tab" [class.active]="searchType === 'companyName'" (click)="onSearchTypeChange('companyName')">
        ğŸ¢ Company Name
      </button>
      <button class="search-tab" [class.active]="searchType === 'sampleId'" (click)="onSearchTypeChange('sampleId')">
        ğŸ”¢ Sample ID
      </button>
    </div>

    <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="search-form">
      <div class="search-input-wrapper">
        <input
          type="text"
          formControlName="searchValue"
          class="search-input"
          [placeholder]="searchType === 'reportNumber' ? 'e.g. RPT-2026-001'
                       : searchType === 'companyName'  ? 'e.g. Acme Industries'
                       : 'e.g. 42'"
        />
        <button type="submit" class="search-btn" [disabled]="loading">
          <span *ngIf="!loading">ğŸ” Search</span>
          <span *ngIf="loading" class="spinner"></span>
        </button>
      </div>
    </form>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- RESULTS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="results-section" *ngIf="hasSearched && searchResults.length > 0">
    <div class="results-header">
      <h2 class="section-title">Search Results</h2>
      <span class="results-count">{{ searchResults.length }} result(s) found (sorted by latest)</span>
    </div>

    <div class="results-grid">
      <div class="result-card" *ngFor="let sample of searchResults">

        <!-- â”€â”€ Card Header â”€â”€ -->
        <div class="result-header">
          <div class="result-badge">{{ sample.reportNumber || 'â€”' }}</div>
          <div class="result-status" [ngClass]="getSampleStatusClass(sample)">
            {{ getSampleStatus(sample) }}
          </div>
        </div>

        <!-- â”€â”€ Card Body â”€â”€ -->
        <div class="result-body">
          <div class="result-info-grid">

            <div class="info-item">
              <span class="info-label">ğŸ†” Sample ID</span>
              <span class="info-value">{{ sample.id ?? 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ”¢ Sample No.</span>
              <span class="info-value">{{ sample.sampleNumber || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“ Description</span>
              <span class="info-value">{{ sample.sampleDescription || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“¦ Project</span>
              <span class="info-value">{{ sample.projectName || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“‹ Format No.</span>
              <span class="info-value">{{ sample.formatNumber || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ”— Party Ref.</span>
              <span class="info-value">{{ sample.partyReferenceNumber || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“… Date Received</span>
              <span class="info-value">{{ sample.dateOfReceiving ? (sample.dateOfReceiving | date:'dd MMM yyyy') : 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“… Reporting Date</span>
              <span class="info-value">{{ sample.reportingDate ? (sample.reportingDate | date:'dd MMM yyyy') : 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">â±ï¸ Analysis Period</span>
              <span class="info-value">{{ sample.periodOfAnalysis || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ”¬ Protocol</span>
              <span class="info-value">{{ sample.samplingAndAnalysisProtocol || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“ Address</span>
              <span class="info-value">{{ sample.address || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ• Last Updated</span>
              <span class="info-value">{{ sample.updatedAt | date:'dd MMM yyyy, HH:mm' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ”§ Tech Check</span>
              <span class="info-value">
                <span class="pill" [ngClass]="sample.techanicianChecked ? 'pill-yes' : 'pill-no'">
                  {{ sample.techanicianChecked ? 'Complete' : 'Pending' }}
                </span>
              </span>
            </div>

            <div class="info-item">
              <span class="info-label">âœ… QA Check</span>
              <span class="info-value">
                <span class="pill" [ngClass]="sample.qualityChecked ? 'pill-yes' : 'pill-no'">
                  {{ sample.qualityChecked ? 'Approved' : 'Pending' }}
                </span>
              </span>
            </div>

          </div>
        </div>

        <!-- â”€â”€ Card Actions â”€â”€ -->
        <div class="result-actions">
          <!-- Edit Info Button: Disabled if QA approved -->
          <button 
            class="action-btn edit-btn" 
            (click)="editGeneralInformation(sample)"
            [disabled]="sample.qualityChecked"
            [title]="sample.qualityChecked ? 'Cannot edit - QA approved' : 'Edit general information'">
            âœï¸ Edit Info
          </button>
          
          <!-- Update Result Button: Disabled if QA approved -->
          <button 
            class="action-btn result-btn" 
            (click)="editSampleResult(sample)"
            [disabled]="sample.qualityChecked"
            [title]="sample.qualityChecked ? 'Cannot edit - QA approved' : 'Update sample result'">
            ğŸ“Š Update Result
          </button>
          
          <!-- Approve QA Button: Disabled if already approved -->
          <button
            class="action-btn approve-btn"
            (click)="approveQuality(sample)"
            [disabled]="sample.qualityChecked"
            [title]="sample.qualityChecked ? 'Already approved' : 'Approve quality check'">
            âœ… {{ sample.qualityChecked ? 'Approved âœ“' : 'Approve QA' }}
          </button>
          
          <!-- Print Report Button: Only visible if QA approved -->
          <button
            *ngIf="sample.qualityChecked"
            class="action-btn print-btn"
            (click)="printReport(sample)"
            title="Print approved report">
            ğŸ–¨ï¸ Print Report
          </button>
        </div>

      </div><!-- /.result-card -->
    </div><!-- /.results-grid -->
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- NO RESULTS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="no-results" *ngIf="hasSearched && searchResults.length === 0 && !loading">
    <div class="no-results-icon">ğŸ”</div>
    <h3>No Results Found</h3>
    <p>
      No quality-ready sample matched the
      <strong>{{ searchType === 'reportNumber' ? 'report number' : searchType === 'companyName' ? 'company name' : 'sample ID' }}</strong>
      you entered.
    </p>
    <p class="hint">ğŸ’¡ Only samples with technician check complete are shown here</p>
  </div>

</div><!-- /.dashboard-container -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODAL: Edit General Information -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <app-quality-general-info
      [sample]="selectedSample"
      (onClose)="closeModal()"
      (onUpdate)="onSearch()">
    </app-quality-general-info>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODAL: Update Sample Result -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" *ngIf="showResultModal" (click)="closeModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <app-quality-sample-result
      [sample]="selectedSample"
      (onClose)="closeModal()"
      (onUpdate)="onSearch()">
    </app-quality-sample-result>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODAL: Approve Quality Check -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" *ngIf="showQualityCheckModal" (click)="closeModal()">
  <div class="modal-content small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>âœ… Approve Quality Check</h3>
      <button class="close-btn" (click)="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="confirmation-text success">
        âœ… Ready to approve this sample for final quality check?
      </p>
      <div class="sample-info-box">
        <div class="confirm-row">
          <span class="confirm-label">Report Number</span>
          <span class="confirm-value">{{ selectedSample?.reportNumber }}</span>
        </div>
        <div class="confirm-row">
          <span class="confirm-label">Sample No.</span>
          <span class="confirm-value">{{ selectedSample?.sampleNumber }}</span>
        </div>
        <div class="confirm-row">
          <span class="confirm-label">Description</span>
          <span class="confirm-value">{{ selectedSample?.sampleDescription }}</span>
        </div>
        <div class="confirm-row">
          <span class="confirm-label">Project</span>
          <span class="confirm-value">{{ selectedSample?.projectName || 'â€”' }}</span>
        </div>
      </div>
      <p class="warning-text">âš ï¸ Once approved, this sample cannot be edited.</p>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeModal()">Cancel</button>
        <button class="confirm-btn success" (click)="confirmQualityCheck()">
          âœ… Confirm Approval
        </button>
      </div>
    </div>
  </div>
</div>