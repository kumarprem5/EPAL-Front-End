<div class="dashboard-container">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- DRAWER OVERLAY -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="drawer-overlay" [class.open]="drawerOpen" (click)="closeDrawer()"></div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SIDE DRAWER -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <nav class="side-drawer" [class.open]="drawerOpen">

    <!-- Drawer Header -->
    <div class="drawer-header">
      <div class="drawer-brand">
        <div class="drawer-brand-icon">ğŸ”¬</div>
        <div>
          <div class="drawer-brand-name">EPAL Portal</div>
          <div class="drawer-brand-sub">Lab Analyst System</div>
        </div>
      </div>
      <button class="drawer-close" (click)="closeDrawer()">âœ•</button>
    </div>

    <!-- User Profile Block -->
    <div class="drawer-user">
      <div class="drawer-avatar">{{ (currentUser?.analystName || 'A')[0].toUpperCase() }}</div>
      <div class="drawer-user-info">
        <div class="drawer-user-name">{{ currentUser?.analystName || 'Analyst' }}</div>
        <div class="drawer-user-role">Lab Analyst</div>
      </div>
    </div>

    <!-- Navigation Links -->
    <div class="drawer-nav">
      <div class="drawer-nav-label">Main Menu</div>

      <button class="drawer-nav-item" [class.active]="activeRoute === '/analyst/dashboard'"
              (click)="navigateTo('/analyst/dashboard')">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-text">Dashboard</span>
        <span class="nav-arrow">â€º</span>
      </button>

      <button class="drawer-nav-item" [class.active]="activeRoute === '/analyst/job-card'"
              (click)="navigateTo('/analyst/job-card')">
        <span class="nav-icon">ğŸ§¾</span>
        <span class="nav-text">Job Cards</span>
        <span class="nav-arrow">â€º</span>
      </button>

      <div class="drawer-nav-label" style="margin-top: 8px;">Search & Reports</div>

      <button class="drawer-nav-item" [class.active]="searchType === 'reportNumber' && activeRoute === '/analyst/dashboard'"
              (click)="onSearchTypeChange('reportNumber'); navigateTo('/analyst/dashboard')">
        <span class="nav-icon">ğŸ“„</span>
        <span class="nav-text">Search by Report No.</span>
        <span class="nav-arrow">â€º</span>
      </button>

      <button class="drawer-nav-item" [class.active]="searchType === 'companyName' && activeRoute === '/analyst/dashboard'"
              (click)="onSearchTypeChange('companyName'); navigateTo('/analyst/dashboard')">
        <span class="nav-icon">ğŸ¢</span>
        <span class="nav-text">Search by Company</span>
        <span class="nav-arrow">â€º</span>
      </button>

      <button class="drawer-nav-item" [class.active]="searchType === 'sampleId' && activeRoute === '/analyst/dashboard'"
              (click)="onSearchTypeChange('sampleId'); navigateTo('/analyst/dashboard')">
        <span class="nav-icon">ğŸ”¢</span>
        <span class="nav-text">Search by Sample ID</span>
        <span class="nav-arrow">â€º</span>
      </button>

      <div class="drawer-divider"></div>

      <button class="drawer-nav-item nav-logout" (click)="logout(); closeDrawer()">
        <span class="nav-icon">ğŸšª</span>
        <span class="nav-text">Logout</span>
        <span class="nav-arrow">â€º</span>
      </button>
    </div>

    <!-- Drawer Footer -->
    <div class="drawer-footer">
      <div class="drawer-footer-text">EPAL Laboratory Portal</div>
      <div class="drawer-footer-version">v1.0.0</div>
    </div>
  </nav>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- HEADER -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <header class="dashboard-header">
    <div class="header-content">

      <div class="header-left">
        <!-- Hamburger -->
        <button class="hamburger-btn" (click)="toggleDrawer()" [class.active]="drawerOpen">
          <span class="ham-line"></span>
          <span class="ham-line"></span>
          <span class="ham-line"></span>
        </button>
        <div class="logo">
          <span class="logo-icon">ğŸ”¬</span>
          <span class="logo-text">Lab Analyst Portal</span>
        </div>
      </div>

      <!-- Desktop nav links -->
      <nav class="header-desktop-nav">
        <button class="hd-nav-btn" [class.active]="activeRoute === '/analyst/dashboard'"
                (click)="navigateTo('/analyst/dashboard')">
          ğŸ“Š Dashboard
        </button>
        <button class="hd-nav-btn" [class.active]="activeRoute === '/analyst/job-card'"
                (click)="navigateTo('/analyst/job-card')">
          ğŸ§¾ Job Cards
        </button>
      </nav>

      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar">{{ (currentUser?.analystName || 'A')[0].toUpperCase() }}</div>
          <span class="user-name">{{ currentUser?.analystName || 'Analyst' }}</span>
        </div>
        <button class="logout-btn" (click)="logout()">
          <span>ğŸšª</span>
          <span class="logout-text">Logout</span>
        </button>
      </div>

    </div>
  </header>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- GLOBAL LOADING OVERLAY -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="global-loading" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>Loading dashboard...</p>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- STATS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="stats-section">
    <div class="stats-grid">

      <div class="stat-card">
        <div class="stat-icon pending">ğŸ“‹</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.pendingAnalysis }}</div>
          <div class="stat-label">Pending Analysis</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon completed">âœ…</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.completedToday }}</div>
          <div class="stat-label">Completed Today</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon forwarded">ğŸ“¤</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.forwardedToTechnician }}</div>
          <div class="stat-label">Forwarded to Technician</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon total">ğŸ“Š</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.totalProcessed }}</div>
          <div class="stat-label">Total Processed</div>
        </div>
      </div>

    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SEARCH -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="search-section">
    <div class="section-header">
      <h2 class="section-title">Search Reports</h2>
      <p class="section-subtitle">Find samples by report number, company name, or sample ID</p>
    </div>

    <div class="search-tabs">
      <button class="search-tab" [class.active]="searchType === 'reportNumber'" (click)="onSearchTypeChange('reportNumber')">
        ğŸ“„ Report Number
      </button>
      <button class="search-tab" [class.active]="searchType === 'companyName'" (click)="onSearchTypeChange('companyName')">
        ğŸ¢ Company Name
      </button>
      <button class="search-tab" [class.active]="searchType === 'sampleId'" (click)="onSearchTypeChange('sampleId')">
        ğŸ”¢ Sample ID
      </button>
    </div>

    <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="search-form">
      <div class="search-input-wrapper">
        <input
          type="text"
          formControlName="searchValue"
          class="search-input"
          [placeholder]="searchType === 'reportNumber' ? 'e.g. RPT-2026-001'
                       : searchType === 'companyName'  ? 'e.g. Acme Industries'
                       : 'e.g. 42'"
        />
        <button type="submit" class="search-btn" [disabled]="loading">
          <span *ngIf="!loading">ğŸ” Search</span>
          <span *ngIf="loading" class="spinner"></span>
        </button>
      </div>
    </form>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- RESULTS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="results-section" *ngIf="hasSearched && searchResults.length > 0">
    <div class="results-header">
      <h2 class="section-title">Search Results</h2>
      <span class="results-count">{{ searchResults.length }} result(s) found</span>
    </div>

    <div class="results-grid">
      <div class="result-card" *ngFor="let sample of searchResults">

        <div class="result-header">
          <div class="result-badge">{{ sample.reportNumber || 'â€”' }}</div>
          <div class="result-status" [ngClass]="getSampleStatusClass(sample)">
            {{ getSampleStatus(sample) }}
          </div>
        </div>

        <div class="result-body">
          <div class="result-info-grid">
            <div class="info-item"><span class="info-label">ğŸ†” Sample ID</span><span class="info-value">{{ sample.id ?? 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ”¢ Sample No.</span><span class="info-value">{{ sample.sampleNumber || 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ“ Description</span><span class="info-value">{{ sample.sampleDescription || 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ“¦ Project</span><span class="info-value">{{ sample.projectName || 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ“‹ Format No.</span><span class="info-value">{{ sample.formatNumber || 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ”— Party Ref.</span><span class="info-value">{{ sample.partyReferenceNumber || 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ“… Date Received</span><span class="info-value">{{ sample.dateOfReceiving ? (sample.dateOfReceiving | date:'dd MMM yyyy') : 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ“… Reporting Date</span><span class="info-value">{{ sample.reportingDate ? (sample.reportingDate | date:'dd MMM yyyy') : 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">â±ï¸ Analysis Period</span><span class="info-value">{{ sample.periodOfAnalysis || 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ”¬ Protocol</span><span class="info-value">{{ sample.samplingAndAnalysisProtocol || 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ“ Address</span><span class="info-value">{{ sample.address || 'â€”' }}</span></div>
            <div class="info-item"><span class="info-label">ğŸ• Created</span><span class="info-value">{{ sample.createdAt | date:'dd MMM yyyy, HH:mm' }}</span></div>
            <div class="info-item">
              <span class="info-label">ğŸ”§ Tech Check</span>
              <span class="info-value">
                <span class="pill" [ngClass]="sample.techanicianChecked ? 'pill-yes' : 'pill-no'">
                  {{ sample.techanicianChecked ? 'Forwarded' : 'Pending' }}
                </span>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">âœ… QA Check</span>
              <span class="info-value">
                <span class="pill" [ngClass]="sample.qualityChecked ? 'pill-yes' : 'pill-no'">
                  {{ sample.qualityChecked ? 'Approved' : 'Pending' }}
                </span>
              </span>
            </div>
          </div>
        </div>

        <div class="result-actions">
          <button class="action-btn edit-btn"   (click)="editGeneralInformation(sample)">âœï¸ Edit Info</button>
          <button class="action-btn result-btn" (click)="editSampleResult(sample)">ğŸ“Š Update Result</button>
          <button class="action-btn forward-btn"
                  (click)="forwardToTechnician(sample)"
                  [disabled]="sample.techanicianChecked"
                  [title]="sample.techanicianChecked ? 'Already forwarded' : 'Forward to technician'">
            ğŸ“¤ {{ sample.techanicianChecked ? 'Forwarded âœ“' : 'Forward' }}
          </button>
        </div>

      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- NO RESULTS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="no-results" *ngIf="hasSearched && searchResults.length === 0 && !loading">
    <div class="no-results-icon">ğŸ”</div>
    <h3>No Results Found</h3>
    <p>No sample matched the <strong>{{ searchType === 'reportNumber' ? 'report number' : searchType === 'companyName' ? 'company name' : 'sample ID' }}</strong> you entered.</p>
  </div>

</div><!-- /.dashboard-container -->

<!-- MODALS unchanged -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <app-analyst-general-info [sample]="selectedSample" (onClose)="closeModal()" (onUpdate)="onSearch()"></app-analyst-general-info>
  </div>
</div>

<div class="modal-overlay" *ngIf="showResultModal" (click)="closeModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <app-analyst-sample-result [sample]="selectedSample" (onClose)="closeModal()" (onUpdate)="onSearch()"></app-analyst-sample-result>
  </div>
</div>

<div class="modal-overlay" *ngIf="showForwardModal" (click)="closeModal()">
  <div class="modal-content small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ğŸ“¤ Forward to Technician</h3>
      <button class="close-btn" (click)="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="confirmation-text">âœ… Forward this sample to the technician for review and processing?</p>
      <div class="sample-info-box">
        <div class="confirm-row"><span class="confirm-label">Report Number</span><span class="confirm-value">{{ selectedSample?.reportNumber }}</span></div>
        <div class="confirm-row"><span class="confirm-label">Sample No.</span><span class="confirm-value">{{ selectedSample?.sampleNumber }}</span></div>
        <div class="confirm-row"><span class="confirm-label">Description</span><span class="confirm-value">{{ selectedSample?.sampleDescription }}</span></div>
        <div class="confirm-row"><span class="confirm-label">Project</span><span class="confirm-value">{{ selectedSample?.projectName || 'â€”' }}</span></div>
      </div>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeModal()">Cancel</button>
        <button class="confirm-btn" (click)="confirmForward()">âœ… Confirm Forward</button>
      </div>
    </div>
  </div>
</div>