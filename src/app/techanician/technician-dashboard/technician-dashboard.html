<div class="dashboard-container">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- HEADER -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo">
          <span class="logo-icon">ğŸ”§</span>
          <span class="logo-text">Lab Technician Portal</span>
        </div>
      </div>
      <div class="header-right">
        <div class="user-info">
          <span class="user-icon">ğŸ‘¤</span>
          <span class="user-name">{{ currentUser?.adminName || currentUser?.name || 'Technician' }}</span>
        </div>
        <button class="logout-btn" (click)="logout()">
          <span>ğŸšª</span> Logout
        </button>
      </div>
    </div>
  </header>
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- GLOBAL LOADING OVERLAY -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="global-loading" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>Loading dashboard...</p>
  </div>
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- STATS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="stats-section">
    <div class="stats-grid">

      <div class="stat-card">
        <div class="stat-icon pending-review">ğŸ”</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.pendingReview }}</div>
          <div class="stat-label">Pending Review</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon sent-back">â†©ï¸</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.sentBackToAnalyst }}</div>
          <div class="stat-label">Sent Back to Analyst</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon forwarded-qa">âœ…</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.forwardedToQuality }}</div>
          <div class="stat-label">Forwarded to QA</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon total">ğŸ“Š</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.totalProcessed }}</div>
          <div class="stat-label">Total Processed</div>
        </div>
      </div>

    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SEARCH -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="search-section">
    <div class="section-header">
      <h2 class="section-title">Search Samples</h2>
      <p class="section-subtitle">Find samples by report number, company name, or sample ID</p>
    </div>

    <div class="search-tabs">
      <button class="search-tab" [class.active]="searchType === 'reportNumber'" (click)="onSearchTypeChange('reportNumber')">
        ğŸ“„ Report Number
      </button>
      <button class="search-tab" [class.active]="searchType === 'companyName'" (click)="onSearchTypeChange('companyName')">
        ğŸ¢ Company Name
      </button>
      <button class="search-tab" [class.active]="searchType === 'sampleId'" (click)="onSearchTypeChange('sampleId')">
        ğŸ”¢ Sample ID
      </button>
    </div>

    <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="search-form">
      <div class="search-input-wrapper">
        <input
          type="text"
          formControlName="searchValue"
          class="search-input"
          [placeholder]="searchType === 'reportNumber' ? 'e.g. RPT-2026-001'
                       : searchType === 'companyName'  ? 'e.g. Acme Industries'
                       : 'e.g. 42'"
        />
        <button type="submit" class="search-btn" [disabled]="loading">
          <span *ngIf="!loading">ğŸ” Search</span>
          <span *ngIf="loading" class="spinner"></span>
        </button>
      </div>
    </form>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- RESULTS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="results-section" *ngIf="hasSearched && searchResults.length > 0">
    <div class="results-header">
      <h2 class="section-title">Search Results</h2>
      <span class="results-count">{{ searchResults.length }} result(s) found</span>
    </div>

    <div class="results-grid">
      <div class="result-card" *ngFor="let sample of searchResults">

        <!-- â”€â”€ Card Header â”€â”€ -->
        <div class="result-header">
          <div class="result-badge">{{ sample.reportNumber || 'â€”' }}</div>
          <div class="result-status" [ngClass]="getSampleStatusClass(sample)">
            {{ getSampleStatus(sample) }}
          </div>
        </div>

        <!-- â”€â”€ Card Body â”€â”€ -->
        <div class="result-body">
          <div class="result-info-grid">

            <div class="info-item">
              <span class="info-label">ğŸ†” Sample ID</span>
              <span class="info-value">{{ sample.id ?? 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ”¢ Sample No.</span>
              <span class="info-value">{{ sample.sampleNumber || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“ Description</span>
              <span class="info-value">{{ sample.sampleDescription || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“¦ Project</span>
              <span class="info-value">{{ sample.projectName || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“‹ Format No.</span>
              <span class="info-value">{{ sample.formatNumber || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ”— Party Ref.</span>
              <span class="info-value">{{ sample.partyReferenceNumber || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“… Date Received</span>
              <span class="info-value">{{ sample.dateOfReceiving ? (sample.dateOfReceiving | date:'dd MMM yyyy') : 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“… Reporting Date</span>
              <span class="info-value">{{ sample.reportingDate ? (sample.reportingDate | date:'dd MMM yyyy') : 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">â±ï¸ Analysis Period</span>
              <span class="info-value">{{ sample.periodOfAnalysis || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ”¬ Protocol</span>
              <span class="info-value">{{ sample.samplingAndAnalysisProtocol || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ“ Address</span>
              <span class="info-value">{{ sample.address || 'â€”' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ• Created</span>
              <span class="info-value">{{ sample.createdAt | date:'dd MMM yyyy, HH:mm' }}</span>
            </div>

            <div class="info-item">
              <span class="info-label">ğŸ”§ Tech Check</span>
              <span class="info-value">
                <span class="pill" [ngClass]="sample.fordwardToTechanician ? 'pill-yes' : 'pill-no'">
                  {{ sample.fordwardToTechanician ? 'Yes' : 'No' }}
                </span>
              </span>
            </div>

            <div class="info-item">
              <span class="info-label">âœ… QA Check</span>
              <span class="info-value">
                <span class="pill" [ngClass]="sample.qualityChecked ? 'pill-yes' : 'pill-no'">
                  {{ sample.qualityChecked ? 'Approved' : 'Pending' }}
                </span>
              </span>
            </div>
          </div>
        </div>
        <!-- â”€â”€ Card Actions â”€â”€ -->
        <div class="result-actions">
          <!-- Edit Info Button: Disabled only if QA approved -->
          <button 
            class="action-btn edit-btn" 
            (click)="editGeneralInformation(sample)"
              [disabled]="sample.qualityChecked || sample.techanicianChecked"
            [title]="sample.qualityChecked ? 'Cannot edit - QA approved' : 'Edit general information'">
            âœï¸ Edit Info
          </button>
          
          <!-- Update Result Button: Disabled only if QA approved -->
          <button 
            class="action-btn result-btn" 
            (click)="editSampleResult(sample)"
              [disabled]="sample.qualityChecked || sample.techanicianChecked"
            [title]="sample.qualityChecked ? 'Cannot edit - QA approved' : 'Update sample result'">
            ğŸ“Š Update Result
          </button>
          
          <!-- Send Back Button: Enabled if techanicianChecked=true AND qualityChecked=false -->
        <button
  class="action-btn sendback-btn"
  (click)="sendBackToAnalyst(sample)"
  [disabled]="sample.qualityChecked || sample.techanicianChecked">
  â†©ï¸ Send Back
</button>

          <!-- Forward to QA Button: Enabled if techanicianChecked=true AND qualityChecked=false -->
   
         <button
  class="action-btn forward-btn"
  (click)="forwardToQualityCheck(sample)"
   [disabled]="sample.qualityChecked || sample.techanicianChecked">
  âœ… Forward to QA
</button>
        </div>

      </div><!-- /.result-card -->
    </div><!-- /.results-grid -->
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- NO RESULTS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="no-results" *ngIf="hasSearched && searchResults.length === 0 && !loading">
    <div class="no-results-icon">ğŸ”</div>
    <h3>No Results Found</h3>
    <p>
      No sample matched the
      <strong>{{ searchType === 'reportNumber' ? 'report number' : searchType === 'companyName' ? 'company name' : 'sample ID' }}</strong>
      you entered.
    </p>
  </div>

</div><!-- /.dashboard-container -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODAL: Edit General Information -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <app-techanician-general-info
      [sample]="selectedSample"
      (onClose)="closeModal()"
      (onUpdate)="onSearch()">
    </app-techanician-general-info>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODAL: Update Sample Result -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" *ngIf="showResultModal" (click)="closeModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <app-technician-sample-result
      [sample]="selectedSample"
      (onClose)="closeModal()"
      (onUpdate)="onSearch()">
    </app-technician-sample-result>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODAL: Send Back to Analyst -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" *ngIf="showSendBackModal" (click)="closeModal()">
  <div class="modal-content small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>â†©ï¸ Send Back to Analyst</h3>
      <button class="close-btn" (click)="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="confirmation-text warning">
        âš ï¸ This will return the sample to the analyst for revision.
      </p>
      <div class="sample-info-box">
        <div class="confirm-row">
          <span class="confirm-label">Report Number</span>
          <span class="confirm-value">{{ selectedSample?.reportNumber }}</span>
        </div>
        <div class="confirm-row">
          <span class="confirm-label">Sample No.</span>
          <span class="confirm-value">{{ selectedSample?.sampleNumber }}</span>
        </div>
        <div class="confirm-row">
          <span class="confirm-label">Description</span>
          <span class="confirm-value">{{ selectedSample?.sampleDescription }}</span>
        </div>
      </div>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeModal()">Cancel</button>
        <button class="confirm-btn warning" (click)="confirmSendBackToAnalyst()">
          â†©ï¸ Confirm Send Back
        </button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODAL: Forward to Quality Check -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" *ngIf="showQualityCheckModal" (click)="closeModal()">
  <div class="modal-content small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>âœ… Forward to Quality Check</h3>
      <button class="close-btn" (click)="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="confirmation-text success">
        âœ… Ready to forward this sample to Quality Assurance?
      </p>
      <div class="sample-info-box">
        <div class="confirm-row">
          <span class="confirm-label">Report Number</span>
          <span class="confirm-value">{{ selectedSample?.reportNumber }}</span>
        </div>
        <div class="confirm-row">
          <span class="confirm-label">Sample No.</span>
          <span class="confirm-value">{{ selectedSample?.sampleNumber }}</span>
        </div>
        <div class="confirm-row">
          <span class="confirm-label">Description</span>
          <span class="confirm-value">{{ selectedSample?.sampleDescription }}</span>
        </div>
        <div class="confirm-row">
          <span class="confirm-label">Project</span>
          <span class="confirm-value">{{ selectedSample?.projectName || 'â€”' }}</span>
        </div>
      </div>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeModal()">Cancel</button>
        <button class="confirm-btn success" (click)="confirmForwardToQualityCheck()">
          âœ… Confirm Forward to QA
        </button>
      </div>
    </div>
  </div>
</div>